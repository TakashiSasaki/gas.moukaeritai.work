<!DOCTYPE html>
<html lang="ja">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Readme/Design</title>
    <?!= include('nav-style'); ?>
    <!-- Navigation CSS and common styles might be included here later -->
    <style>
        body { font-family: sans-serif; margin: 20px; /* padding-top: 60px; Will be handled by nav-style.css.html */ }
        h1, h2 { border-bottom: 1px solid #ccc; padding-bottom: 5px; }
        /* #navigation placeholder styling removed */
        .code { background-color: #f4f4f4; padding: 2px 5px; border-radius: 3px; font-family: monospace; }
        table { border-collapse: collapse; margin-top: 1em; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <nav class="common-navigation">
      <a href="<?= baseUrl ?>" <? if (currentPage === 'index') { ?>class="active"<? } ?>>Display</a>
      <a href="<?= settingsUrl ?>" <? if (currentPage === 'settings') { ?>class="active"<? } ?>>Settings</a>
      <a href="<?= readmeUrl ?>" <? if (currentPage === 'readme') { ?>class="active"<? } ?>>Readme</a>
    </nav>

    <h1>Spreadsheet Viewer Web App - Design Document</h1>

    <h2>1. Overview</h2>
    <p>This document describes the structure and design of the Spreadsheet Viewer web application. The application allows users to select a Google Spreadsheet and view its content. Functionality is split across a main display page, a settings page, and this readme page.</p>

    <h2>2. File Structure</h2>
    <p>The application consists of the following key files within the 'bookmark-sheets' directory:</p>
    <table>
        <thead>
            <tr>
                <th>File</th>
                <th>Purpose</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>index.html</code></td>
                <td>Main page for displaying spreadsheet content.</td>
            </tr>
            <tr>
                <td><code>settings.html</code></td>
                <td>Page for configuring application settings, primarily selecting the target spreadsheet.</td>
            </tr>
            <tr>
                <td><code>readme.html</code></td>
                <td>This design document and application guide.</td>
            </tr>
            <tr>
                <td><code>script.html</code></td>
                <td>Client-side JavaScript for <code>index.html</code> (content display).</td>
            </tr>
            <tr>
                <td><code>style.html</code></td>
                <td>CSS styles for <code>index.html</code> and common elements.</td>
            </tr>
            <tr>
                <td><code>settings.js.html</code></td>
                <td>Client-side JavaScript specific to <code>settings.html</code>.</td>
            </tr>
            <tr>
                <td><code>settings.css.html</code></td>
                <td>CSS styles specific to <code>settings.html</code>.</td>
            </tr>
            <tr>
                <td><code>doGet.gs</code></td>
                <td>Server-side Apps Script file containing the main <code>doGet(e)</code> function for routing.</td>
            </tr>
            <tr>
                <td><code>Code.gs</code></td>
                <td>Server-side Apps Script file for backend logic (e.g., Google Drive interaction, utility functions like <code>include()</code>). Moved from Code.js</td>
            </tr>
            <tr>
                <td><code>appsscript.json</code></td>
                <td>Apps Script project manifest file.</td>
            </tr>
        </tbody>
    </table>

    <h2>3. Routing</h2>
    <p>The application uses URL path-based routing, handled by the <code>doGet(e)</code> function in <code>doGet.gs</code>. The <code>e.pathInfo</code> property from the event object determines which page is served:</p>
    <ul>
        <li>Base URL (e.g., <code>.../exec/</code>): Serves <code>index.html</code>.</li>
        <li>Base URL + <code>/settings</code> (e.g., <code>.../exec/settings</code>): Serves <code>settings.html</code>.</li>
        <li>Base URL + <code>/readme</code> (e.g., <code>.../exec/readme</code>): Serves <code>readme.html</code>.</li>
    </ul>
    <p>The <code>HtmlService.createTemplateFromFile(filename).evaluate()</code> method is used to serve these pages.</p>

    <h2>4. Navigation</h2>
    <p>A common navigation UI is implemented across <code>index.html</code>, <code>settings.html</code>, and <code>readme.html</code>. This allows users to easily switch between the 'Display', 'Settings', and 'Readme' sections of the application. The navigation links will use the appropriate paths (e.g., <code>${webappUrl}</code>, <code>${webappUrl}/settings</code>, <code>${webappUrl}/readme</code>).</p>

    <h2>5. Key Functionalities</h2>
    <h3>5.1. Settings Page (<code>settings.html</code>)</h3>
    <ul>
        <li>Search for Google Spreadsheets by name.</li>
        <li>Select a spreadsheet by its ID.</li>
        <li>View details of the selected spreadsheet (title, sheet names, headers).</li>
        <li>Save the selected spreadsheet ID for the application to use.</li>
    </ul>
    <h3>5.2. Display Page (<code>index.html</code>)</h3>
    <ul>
        <li>Loads and displays content from the first sheet of the currently selected Google Spreadsheet.</li>
        <li>Content is expected to have specific columns (e.g., 'url', 'title', 'image', 'tags') for optimal display.</li>
        <li>Provides a reload button to refresh content.</li>
    </ul>

    <p><em>This readme provides a high-level overview of the application's refactored design.</em></p>
</body>
</html>
